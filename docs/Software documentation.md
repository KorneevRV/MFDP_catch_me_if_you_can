# Архитектура проекта

Проект имеет модульную архитектуру на базе Docker контейнеров, состоящую из следующих основных компонентов:

1. **Frontend (Streamlit):** Предоставляет пользовательский интерфейс для взаимодействия с сервисом. 

2. **Backend (FastAPI)**. Включает в себя API для обработки HTTP-запросы, обеспечивая взаимодействие между пользователем и серверной частью.

3. **База данных (PostgreSQL)**: Хранит информацию о пользователях и логи запросов.

4. **Очередь сообщений (RabbitMQ)**: Использует воркеров (`src/app/worker.py`) для асинхронной обработки задач.

## Основные компоненты backend части сервиса:

**а) API** (`api.py`):

Основной входной точкой приложения является файл api.py.
Используется FastAPI для создания API в соответствии с фреймворком REST API.

**б) Аутентификация** (`auth/`):
- authenticate.py для проверки подлинности токена, хранимого в cookie.
- hash_password.py для создания и верификации хеша пароля.
- jwt_handler.py для создания и хранения JWT токенов.

**в) База данных** (`database/`):

Модуль config.py для получения переменных окружения конфигурации базы данных.
Модуль database.py для создания и инициализации соединения с базой данных.

**г) Модели машинного обучения** (`mlsys/`):

Хранит две модели - `model_from.pkl` и `model_to.pkl`, обученных предсказывать верхнюю и нижнюю границу диапазона зарплаты.

Архитектура модели машинного обучения:
1. Предобработка текстовых данных - для векторизации используется TF-IDF к текстовым полям 'Name' и 'Description'.
2. Регрессионная модель - в качестве основного алгоритма используется ElasticNet.

Процесс обучения модели - в файле `notebooks\enhanced_model.ipynb`

**д) Модели данных** (`models/`):
- logs.py для определения структуры логов.
- user.py для определения структуры пользователей.

**е) Очередь сообщений** (`rabbit/`):
- connection.py для установления соединения с RabbitMQ.

**ж) Маршрутизация** (`routes/`):
- Отдельные файлы (home.py, ml.py, user.py) для различных эндпоинтов API

**з) Сервисы** (`services/`):
- logs.py содержит функции вызываемые при логировании.
- user.py содержит функции вызываемые при обработке пользовательских запросов.

## **Автотестирование**

Данные для создание тест-кейсов хранятся в `tests/cases.py`. Тестами покрыты все функции API, в том числе:
- регистрации и авторизации пользователей;
- отправка запросов, получение ответов от модели и 
- просмотр истории запросов
